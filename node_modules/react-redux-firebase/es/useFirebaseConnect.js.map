{"version":3,"sources":["../src/useFirebaseConnect.js"],"names":["useFirebaseConnect","queriesConfig","firebase","eventRef","dataRef","data","current","itemsToSubscribe","itemsToUnsubscribe","dispatch"],"mappings":"qdA+De,QAASA,CAAAA,kBAAT,CAA4BC,aAA5B,CAA2C,IAClDC,CAAAA,QAAQ,CAAG,0BADuC,CAElDC,QAAQ,CAAG,mBAFuC,CAGlDC,OAAO,CAAG,mBAHwC,CAKlDC,IAAI,CAAG,mBAAQ,iBAAM,4BAAiBJ,aAAjB,CAAN,CAAR,CAA+C,CAACA,aAAD,CAA/C,CAL2C,CAOxD,qBAAU,UAAM,CACd,GAAa,IAAT,GAAAI,IAAI,EAAa,CAAC,sBAAQA,IAAR,CAAcD,OAAO,CAACE,OAAtB,CAAtB,CAAsD,IAC9CC,CAAAA,gBAAgB,CAAG,6BAAeF,IAAf,CAAqBD,OAAO,CAACE,OAA7B,mBAD2B,CAE9CE,kBAAkB,CAAG,6BAAeJ,OAAO,CAACE,OAAvB,CAAgCD,IAAhC,mBAFyB,CAIpDD,OAAO,CAACE,OAAR,CAAkBD,IAJkC,CAMpD,yBACEH,QADF,CAEEA,QAAQ,CAACO,QAFX,CAGE,8BAAmBD,kBAAnB,CAHF,CANoD,CAYpDL,QAAQ,CAACG,OAAT,CAAmB,8BAAmBD,IAAnB,CAZiC,CAepD,uBACEH,QADF,CAEEA,QAAQ,CAACO,QAFX,CAGE,8BAAmBF,gBAAnB,CAHF,CAKD,CACF,CAtBD,CAsBG,CAACF,IAAD,CAtBH,CAPwD,CAgCxD,qBAAU,UAAM,CACd,MAAO,WAAM,CACX,yBAAcH,QAAd,CAAwBA,QAAQ,CAACO,QAAjC,CAA2CN,QAAQ,CAACG,OAApD,CACD,CACF,CAJD,CAIG,EAJH,CAKD,C","sourcesContent":["import { isEqual, differenceWith } from 'lodash'\nimport { useMemo, useEffect, useRef } from 'react'\nimport { watchEvents, unWatchEvents } from './actions/query'\nimport { getEventsFromInput, invokeArrayQuery } from './utils'\nimport useFirebase from './useFirebase'\n\n/**\n * @description Hook that automatically listens/unListens to provided firebase paths\n * using React's useEffect hook.\n * @param {object|string|Function|Array} queriesConfig - Object, string, or\n * array contains object or string for path to sync from Firebase or null if\n * hook doesn't need to sync. Can also be a function that returns an object,\n * a path string, or array of an object or a path string.\n * @see https://react-redux-firebase.com/docs/api/useFirebaseConnect.html\n * @example <caption>Ordered Data</caption>\n * import React from 'react'\n * import { useSelector } from 'react-redux'\n * import { useFirebaseConnect } from 'react-redux-firebase'\n *\n * export default function Todos() {\n *   // sync /todos from firebase into redux\n *   useFirebaseConnect('todos')\n *   // Connect to redux state using selector hook\n *   const todos = useSelector(state => state.firebase.data.todos)\n *   return (\n *     <div>\n *       {JSON.stringify(todos, null, 2)}\n *     </div>\n *   )\n * }\n * @example <caption>Data that depends on props</caption>\n * import React from 'react'\n * import { compose } from 'redux'\n * import { useSelector } from 'react-redux'\n * import { useFirebaseConnect } from 'react-redux-firebase'\n *\n * export default function Post({ postId }) {\n *   useFirebaseConnect(`posts/${postId}`) // sync /posts/postId from firebase into redux\n *   const post = useSelector(({ firebase: { ordered: { posts } } }) => posts && posts[postId])\n *   return (\n *     <div>\n *       {JSON.stringify(post, null, 2)}\n *     </div>\n *   )\n * }\n * @example <caption>Data that depends on props, an array as a query</caption>\n * import React from 'react'\n * import { compose } from 'redux'\n * import { useSelector } from 'react-redux'\n * import { useFirebaseConnect, getVal } from 'react-redux-firebase'\n *\n * export default function Post({ postId }) {\n *   useFirebaseConnect([`posts/${postId}`], [postId]) // sync /posts/postId from firebase into redux\n *   const post = useSelector(state => {\n *     return state.firebase.ordered.posts && state.firebase.ordered.posts[postId]\n *   })\n *   return (\n *     <div>\n *       {JSON.stringify(post, null, 2)}\n *     </div>\n *   )\n * }\n */\nexport default function useFirebaseConnect(queriesConfig) {\n  const firebase = useFirebase()\n  const eventRef = useRef()\n  const dataRef = useRef()\n\n  const data = useMemo(() => invokeArrayQuery(queriesConfig), [queriesConfig])\n\n  useEffect(() => {\n    if (data !== null && !isEqual(data, dataRef.current)) {\n      const itemsToSubscribe = differenceWith(data, dataRef.current, isEqual)\n      const itemsToUnsubscribe = differenceWith(dataRef.current, data, isEqual)\n\n      dataRef.current = data\n      // UnWatch all current events\n      unWatchEvents(\n        firebase,\n        firebase.dispatch,\n        getEventsFromInput(itemsToUnsubscribe)\n      )\n      // Get watch events from new data\n      eventRef.current = getEventsFromInput(data)\n\n      // Watch new events\n      watchEvents(\n        firebase,\n        firebase.dispatch,\n        getEventsFromInput(itemsToSubscribe)\n      )\n    }\n  }, [data])\n\n  // Emulate componentWillUnmount\n  useEffect(() => {\n    return () => {\n      unWatchEvents(firebase, firebase.dispatch, eventRef.current)\n    }\n  }, [])\n}\n"],"file":"useFirebaseConnect.js"}